# 记忆系统

Memoh 的核心特色之一是为每个 Bot 提供独立的 **结构化长期记忆**。记忆系统基于向量数据库（Qdrant），可以语义搜索相关记忆并注入到对话上下文中。

## 进入记忆管理

Bot 详情页 → **记忆** 标签。

## 页面布局

- **左侧面板**：记忆列表，支持搜索和刷新。
- **右侧面板**：选中记忆后显示内容编辑器。
- **下方图表**：向量可视化区域。

## 浏览记忆

记忆列表按创建时间排序，每条记忆显示内容预览。

### 搜索

在搜索框中输入关键词，可以按记忆内容进行模糊筛选。

### 查看详情

点击某条记忆，右侧面板展示完整内容（Markdown 格式）。

## 编辑记忆

选中记忆后，右侧面板切换为编辑模式：
- 文本区域可直接修改记忆内容。
- 修改后点击 **保存** 按钮提交更改。
- 如需取消修改，点击其他记忆或关闭面板。

## 创建记忆

点击 **新建** 按钮，打开创建对话框：

1. **从对话历史创建**：勾选最近的对话消息，系统会将选中的消息内容提取为记忆。
2. **手动输入**：在文本区域中直接编写记忆内容。
3. 点击确认后，记忆会被向量化并存入数据库。

## 记忆压缩

当记忆数量过多时，可以使用 **压缩** 功能：

点击压缩按钮，配置以下参数：

| 参数 | 说明 |
|------|------|
| 压缩比例 | 可选 0.8、0.5、0.3，数值越小压缩越激进 |
| 衰减日期 | 可选，设置一个日期，早于此日期的记忆权重会降低 |

压缩操作会合并和精简相似的记忆，减少存储空间并提高检索效率。

## 删除记忆

选中记忆后，点击 **删除** 按钮并确认即可删除。

## 向量可视化

记忆页面下方提供两种图表：

### Top-K Bucket（柱状图）

展示记忆向量在不同 Top-K 桶中的分布情况，反映记忆的语义密度分布。

### Energy Gradient / CDF（折线图）

累积分布函数曲线，展示记忆向量的能量分布。鼠标悬停可查看具体数值。

这两个图表帮助你直观了解记忆库的质量和分布状态。

## 记忆的工作原理

1. 用户发送消息 → Bot 处理对话。
2. 对话结束后，系统自动提取关键信息，存储为记忆条目。
3. 每条记忆会通过嵌入模型（Embedding Model）转换为向量。
4. 下次对话时，系统根据用户消息进行语义搜索，找到最相关的记忆。
5. 相关记忆被注入到 Bot 的对话上下文中，让 Bot "记住" 之前的信息。

这意味着：
- Bot 可以跨对话保持记忆连续性。
- 记忆是结构化的，而非简单的对话历史。
- 你可以手动编辑记忆，纠正或补充 Bot 的认知。
